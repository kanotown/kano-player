"use strict";const video=document.getElementById("myVideo")||document.querySelector("video")||(console.error("Kano Player: No video element found."),null),canvas=document.getElementById("myCanvas")||document.querySelector("canvas")||(console.error("Kano Player: No canvas element found."),null);video&&canvas?canvas.oncontextmenu=function(){return!1}:console.error("Kano Player: Required elements not found.");const ctx=canvas?canvas.getContext("2d"):null;let press=!1,drag=!1,playAnime=!1,pauseAnime=!1,stepBackAnime=!1,stepForwardAnime=!1,alpha=0,videoScale=1,videoScaleIndex=0,mouseX=500,mouseY=150,imageDifX=0,imageDifY=0,videoLoading=!0,loadAnimeIndex=0,bufCurrentTime=0;const MAX_ALPHA=.6,MAX_SCALE=5;let VIDEO_WIDTH=1920,VIDEO_HEIGHT=1080;const VIDEO_PADDING=0,DURATION_DIF=.17,SEEKBAR_HEIGHT=55,SEEKBAR_MARGIN=20;let coordLeft,coordWidth,coordTop,coordHeight,coordLeftBuf,coordTopBuf,mouseMoveX,mouseMoveY,mouseDragX,mouseDragY,mouseXanytime,mouseYanytime;const PLAY_PAUSE_MARGIN=35,STEP_BACK_MARGIN=95,STEP_FORWARD_MARGIN=145,VOLUME_MARGIN_NORMAL=185;let VOLUME_MARGIN,theaterMargin,fullscreenMargin,isNarrowCanvas,playing=!1,onSeekBar=!1,pressSeekBar=!1,dragSeekBar=!1,resume=!1,onPlayPause=!1,onStepBack=!1,onStepForward=!1,onVolume=!1,onVolumeControl=!1,dragVolumeControl=!1,onTheater=!1,theaterMode=!1,theaterTmp=!1,onVideoRate0_7=!1,onVideoRate1_0=!1,onVideoRate1_5=!1,onVideoRate2_0=!1,onCanvas=!1,fading=!1,pressOnContoroller=!1,dragOnController=!1,fadeAlpha=0,seekBallRad=0,stopCount=100,onMediaControl=!1,onPlayBackTrigger=!1,pressPlayBackTrigger=!1,onPlayBacks=[!1,!1,!1,!1,!1,!1,!1];const FACE_TRACE_MARGIN=340,FULLSCREEN_MARGIN=390;let faceTrace=!1,onFaceTrace=!1,onFullscreen=!1,isFullscreenMode=!1,finished=!1,replayPosY,replayHeight,onReplay=!1,metadataLoaded=!1,originalMaxWidth="1200px";function handleFSevent(){let e=void 0!==document.FullscreenElement&&null!==document.FullscreenElement||void 0!==document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement;if(theaterMode&&!e&&(theaterTmp=!0,theaterMode=!1,init()),isFullscreenMode&&!e){isFullscreenMode=!1;let t=document.getElementById("main");t&&(t.style.background="white"),canvas&&(canvas.style.maxWidth=originalMaxWidth),init()}}function init(){canvas.width=theaterTmp?canvasWidthBuf:canvas.clientWidth,canvas.height=canvas.width*VIDEO_HEIGHT/VIDEO_WIDTH+0,coordLeft=0,coordWidth=canvas.width,coordTop=0,coordHeight=canvas.height-0,videoScale=1,videoScaleIndex=0,(isNarrowCanvas=canvas.width<=600)?fullscreenMargin=(theaterMargin=(VOLUME_MARGIN=70)+120+15)+40+15:(VOLUME_MARGIN=185,theaterMargin=canvas.width-220,fullscreenMargin=canvas.width-160),replayPosY=(canvas.height-80)/2,replayHeight=80,theaterTmp&&(scrollTo(0,scrollPosBuf),theaterTmp=!1)}document.addEventListener("keydown",keyDown),canvas.addEventListener("click",mouseClick),canvas.addEventListener("mousemove",mouseMove),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mouseout",mouseOut),canvas.addEventListener("mouseover",mouseOver),canvas.addEventListener("mousewheel",canvasZoom),window.addEventListener("resize",function(){let e=0;e=window.innerWidth*VIDEO_HEIGHT/VIDEO_WIDTH<=window.innerHeight?window.innerWidth:window.innerHeight*VIDEO_WIDTH/VIDEO_HEIGHT-10,theaterMode||(e=Math.min(e,parseInt(originalMaxWidth)||1200)),canvas&&(canvas.style.maxWidth=e+"px"),init()},!1),document.addEventListener("webkitfullscreenchange",handleFSevent,!1),document.addEventListener("mozfullscreenchange",handleFSevent,!1),document.addEventListener("MSFullscreenChange",handleFSevent,!1),document.addEventListener("fullscreenchange",handleFSevent,!1);let isIE=!1;function msieversion(){let e=window.navigator.userAgent,t=e.indexOf("MSIE ");isIE=t>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)}function draw(){ctx.globalAlpha=1,ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.translate(0,0),ctx.scale(videoScale,videoScale),isIE?ctx.drawImage(video,-coordLeft,-coordTop,canvas.width,canvas.height):ctx.drawImage(video,-coordLeft,-coordTop+0,canvas.width,canvas.height-0);for(let e=0;e<captions.length;e++){let t=captions[e],a=void 0!==t.startTime?t.startTime:t[0],o=void 0!==t.endTime?t.endTime:t[1];if(video.currentTime>=a&&video.currentTime<o){if(void 0!==t.text){let i=t.fontSize*(canvas.width/1124);ctx.font=(t.bold?"bold ":"")+i+'px "Meiryo", "Hiragino Kaku Gothic ProN", sans-serif',ctx.textAlign=t.align;let l=t.text.split("\n");if(t.backgroundColor){let n=0,c=0;for(let r=0;r<l.length;r++)c=Math.max(c,ctx.measureText(l[r]).width);n="left"===t.align?0:"center"===t.align?c/2:c,ctx.fillStyle=t.backgroundColor,ctx.fillRect(canvas.width*t.positionX-coordLeft-n-10,(canvas.height-0)*t.positionY-coordTop-1.3*i/2-2.5,c+20,1.3*i*l.length+10)}for(let s=0;s<l.length;s++){let d=l[s],$=i/2;s>0&&($+=1.3*i*s);let h=canvas.width*t.positionX-coordLeft,g=(canvas.height-0)*t.positionY-coordTop+$;t.strokeWidth>0&&(ctx.strokeStyle=t.strokeColor||"black",ctx.lineWidth=t.strokeWidth,ctx.strokeText(d,h,g)),ctx.fillStyle=t.textColor||"white",ctx.fillText(d,h,g)}}else{let u;t[3].endsWith("b")?(u=Number(t[3].substring(0,t[3].indexOf("b"))),u*=canvas.width/1124,ctx.font="bold "+u+'px "Meiryo", "Hiragino Kaku Gothic ProN", sans-serif'):(u=Number(t[3]),u*=canvas.width/1124,ctx.font=u+'px "Meiryo", "Hiragino Kaku Gothic ProN", sans-serif'),ctx.textAlign=t[4];let v=t[2].split("\n"),x=380*(canvas.width/1124-1)*(.5-t[6]);if(t.length>7){let f=0,m=0;for(let _=0;_<v.length;_++)m=Math.max(m,ctx.measureText(v[_]).width);f="left"==t[4]?0:"center"==t[4]?m/2:m,ctx.fillStyle=t[7],ctx.fillRect(canvas.width*t[5]-coordLeft-f-10,canvas.height*t[6]-coordTop-1.3*u/2-x-2.5,m+20,1.3*u*v.length+10)}ctx.fillStyle="white";for(let p=0;p<v.length;p++){let y=v[p],M=u/2;p>0&&(M+=1.3*u*p),ctx.fillText(y,canvas.width*t[5]-coordLeft,canvas.height*t[6]+M-coordTop-x)}}}}if(ctx.restore(),debug&&(ctx.font='bold 20px "Meiryo", "Hiragino Kaku Gothic ProN", sans-serif',ctx.fillStyle="white",ctx.textAlign="left",ctx.fillText("time: "+video.currentTime.toFixed("2"),10,20),ctx.fillText("("+(mouseMoveX/canvas.width).toFixed(2)+", "+(mouseMoveY/canvas.height).toFixed(2)+")",10,40)),ctx.textAlign="right",finished){theaterMode&&flipTheaterMode();let T=ctx.createRadialGradient(canvas.width/2,canvas.height/2,0,canvas.width/2,canvas.height/2,Math.max(canvas.width,canvas.height)/2);T.addColorStop(0,"rgba(0, 0, 0, 0.7)"),T.addColorStop(1,"rgba(0, 0, 0, 0.9)"),ctx.fillStyle=T,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.shadowColor="rgba(0, 0, 0, 0.5)",ctx.shadowBlur=20,ctx.shadowOffsetX=0,ctx.shadowOffsetY=10;let S=(canvas.width-200)/2,k=(canvas.height-80)/2,b=ctx.createLinearGradient(S,k,S,k+80);onReplay?(b.addColorStop(0,"rgba(70, 70, 70, 0.9)"),b.addColorStop(1,"rgba(50, 50, 50, 0.9)")):(b.addColorStop(0,"rgba(60, 60, 60, 0.8)"),b.addColorStop(1,"rgba(40, 40, 40, 0.8)")),ctx.fillStyle=b,ctx.beginPath(),ctx.roundRect(S,k,200,80,15),ctx.fill(),ctx.shadowColor="transparent",ctx.shadowBlur=0,ctx.strokeStyle=onReplay?"rgba(255, 255, 255, 0.4)":"rgba(255, 255, 255, 0.2)",ctx.lineWidth=2,ctx.stroke(),ctx.fillStyle=onReplay?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.7)";let A=S+50,w=k+40;ctx.lineWidth=3,ctx.strokeStyle=ctx.fillStyle,ctx.beginPath(),ctx.arc(A,w,20,-Math.PI/2-.8,Math.PI/2+1.2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(A-20+5,w-20-3),ctx.lineTo(A-20+15,w-20+7),ctx.lineTo(A-20-5,w-20+10),ctx.closePath(),ctx.fill(),ctx.fillStyle=onReplay?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.7)",ctx.font='bold 26px "Arial"',ctx.textAlign="left",ctx.fillText("Replay",A+40,w+8),requestAnimationFrame(draw);return}if(playAnime?(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-alpha)/2,.3+(.6-alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.fillStyle="rgba(255, 255, 255, "+alpha+")",ctx.beginPath(),ctx.moveTo(-30,-45),ctx.lineTo(50,0),ctx.lineTo(-30,45),ctx.closePath(),ctx.fill(),(alpha-=.02)<0&&(playAnime=!1),ctx.restore()):pauseAnime?(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-alpha)/2,.3+(.6-alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.lineWidth=22,ctx.strokeStyle="rgba(255, 255, 255, "+alpha+")",ctx.beginPath(),ctx.moveTo(-23,-45),ctx.lineTo(-23,45),ctx.moveTo(23,-45),ctx.lineTo(23,45),ctx.stroke(),(alpha-=.02)<0&&(pauseAnime=!1),ctx.restore()):stepBackAnime?(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-alpha)/2,.3+(.6-alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.strokeStyle="rgba(255, 255, 255, "+alpha+")",ctx.lineWidth=12,ctx.beginPath(),ctx.arc(0,0,55,-Math.PI/2-.61,Math.PI/2+1.2),ctx.stroke(),ctx.fillStyle="rgba(255, 255, 255, "+alpha+")",ctx.beginPath(),ctx.moveTo(-45,-60),ctx.lineTo(-18,-31),ctx.lineTo(-60,-20),ctx.closePath(),ctx.fill(),ctx.font='48px "Arial"',ctx.fillText("10",25,20),(alpha-=.02)<0&&(stepBackAnime=!1),ctx.restore()):stepForwardAnime&&(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-alpha)/2,.3+(.6-alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.strokeStyle="rgba(255, 255, 255, "+alpha+")",ctx.lineWidth=12,ctx.beginPath(),ctx.arc(0,0,55,-Math.PI/2+.61,Math.PI/2-1.2,!0),ctx.stroke(),ctx.fillStyle="rgba(255, 255, 255, "+alpha+")",ctx.beginPath(),ctx.moveTo(45,-60),ctx.lineTo(18,-31),ctx.lineTo(60,-20),ctx.closePath(),ctx.fill(),ctx.font='48px "Arial"',ctx.fillText("10",25,20),(alpha-=.02)<0&&(stepForwardAnime=!1),ctx.restore()),onCanvas&&!onMediaControl&&playing&&0==--stopCount&&(fading=!0,fadeAlpha=50),onCanvas||!playing||fading){fading&&(0===fadeAlpha?(ctx.globalAlpha=0,onCanvas&&(document.body.style.cursor="none")):(fadeAlpha--,ctx.globalAlpha=Math.min(10,fadeAlpha)/10));let P="rgba(40, 40, 40, 0.6)",E=ctx.createLinearGradient(0,canvas.height-110,0,canvas.height);E.addColorStop(0,"rgba(0, 0, 0, 0)"),E.addColorStop(.4,"rgba(0, 0, 0, 0.1)"),E.addColorStop(.5,"rgba(0, 0, 0, 0.6)"),E.addColorStop(1,"rgba(0, 0, 0, 0.9)"),ctx.fillStyle=E,ctx.fillRect(0,canvas.height-110,canvas.width,110);let I=canvas.width-40;if(onSeekBar||dragSeekBar?ctx.lineWidth=7:ctx.lineWidth=6,ctx.strokeStyle="rgba(180, 180, 180, 0.3)",ctx.beginPath(),ctx.moveTo(19.5,canvas.height-55),ctx.lineTo(canvas.width-20+.5,canvas.height-55),ctx.stroke(),onSeekBar||dragSeekBar?ctx.lineWidth=5:ctx.lineWidth=4,ctx.strokeStyle="gray",ctx.beginPath(),ctx.moveTo(20,canvas.height-55),ctx.lineTo(canvas.width-20,canvas.height-55),ctx.stroke(),video.buffered.length>0){ctx.strokeStyle="lightgray";for(let F=0;F<video.buffered.length&&!(video.buffered.start(F)>video.currentTime);F++)video.buffered.end(F)<video.currentTime||(ctx.beginPath(),ctx.moveTo(20+I*video.currentTime/(video.duration-.17),canvas.height-55),video.buffered.end(F)===video.duration?ctx.lineTo(20+I*(video.buffered.end(F)-.17)/(video.duration-.17),canvas.height-55):ctx.lineTo(20+I*video.buffered.end(F)/(video.duration-.17),canvas.height-55),ctx.stroke())}if(ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(20,canvas.height-55),ctx.lineTo(20+I*video.currentTime/(video.duration-.17),canvas.height-55),ctx.stroke(),(onSeekBar||dragSeekBar)&&!dragVolumeControl?(seekBallRad<6&&seekBallRad++,ctx.fillStyle="red",ctx.beginPath(),ctx.arc(20+I*video.currentTime/(video.duration-.17),canvas.height-55,seekBallRad,0,2*Math.PI),ctx.fill()):seekBallRad>0&&(seekBallRad--,ctx.fillStyle="red",ctx.beginPath(),ctx.arc(20+I*video.currentTime/(video.duration-.17),canvas.height-55,seekBallRad,0,2*Math.PI),ctx.fill()),video.currentTime>=video.duration-.17&&!video.onwaiting&&(video.currentTime=video.duration,playing&&flipPlayPauseVideo(),finished=!0),(onSeekBar||dragSeekBar)&&!dragVolumeControl){let B=(mouseMoveX-20)/(canvas.width-40),R=0;(B=I*Math.max(0,Math.min(1,B)))-7<20?R=20-B+7:B+27>canvas.width-40&&(R=canvas.width-40-B-27),ctx.fillStyle=P,ctx.fillRect(R+B-27+20,canvas.height-55-37,54,27);let C=(mouseMoveX-20)/(canvas.width-40),L=Math.floor((C=(video.duration-.17)*Math.max(0,Math.min(1,C)))/60),V=Math.floor(C%60),X="";X+=L<10?"0"+L+":":L+":",X+=V<10?"0"+V:V,ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="center",ctx.fillText(X,R+B+20,canvas.height-55-18)}!onPlayPause||dragSeekBar||dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",playing?(ctx.fillStyle=P,ctx.fillRect(20,canvas.height-55-37,94,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("Stop [space]",25,canvas.height-55-18)):(ctx.fillStyle=P,ctx.fillRect(20,canvas.height-55-37,92,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("Play [space]",25,canvas.height-55-18))),playing?(ctx.lineWidth=4,ctx.beginPath(),ctx.moveTo(38,canvas.height-35),ctx.lineTo(38,canvas.height-15),ctx.moveTo(48,canvas.height-35),ctx.lineTo(48,canvas.height-15),ctx.stroke()):(ctx.beginPath(),ctx.moveTo(35,canvas.height-35),ctx.lineTo(55,canvas.height-25),ctx.lineTo(35,canvas.height-15),ctx.closePath(),ctx.fill()),isNarrowCanvas||(!onStepBack||dragSeekBar||dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",ctx.fillStyle=P,ctx.fillRect(50,canvas.height-55-37,100,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("10s back [←]",55,canvas.height-55-18)),ctx.lineWidth=3,ctx.beginPath(),ctx.arc(95,canvas.height-25,13,-Math.PI/2-.8,Math.PI/2+1.2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(84,canvas.height-38),ctx.lineTo(92,canvas.height-31),ctx.lineTo(83,canvas.height-28),ctx.closePath(),ctx.fill(),ctx.font='11px "Arial"',ctx.textAlign="right",ctx.fillText("10",101,canvas.height-20)),isNarrowCanvas||(!onStepForward||dragSeekBar||dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",ctx.fillStyle=P,ctx.fillRect(100,canvas.height-55-37,120,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("10s forward [→]",105,canvas.height-55-18)),ctx.lineWidth=3,ctx.beginPath(),ctx.arc(145,canvas.height-25,13,-Math.PI/2+.8,Math.PI/2-1.2,!0),ctx.stroke(),ctx.beginPath(),ctx.moveTo(156,canvas.height-38),ctx.lineTo(148,canvas.height-31),ctx.lineTo(157,canvas.height-28),ctx.closePath(),ctx.fill(),ctx.font='11px "Arial"',ctx.textAlign="right",ctx.fillText("10",150,canvas.height-20)),!onVolume||dragSeekBar||dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",ctx.fillStyle=P,ctx.fillRect(VOLUME_MARGIN-18,canvas.height-55-37,70,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("Mute [m]",VOLUME_MARGIN-13,canvas.height-55-18)),ctx.beginPath(),ctx.moveTo(VOLUME_MARGIN,canvas.height-30),ctx.lineTo(VOLUME_MARGIN+6,canvas.height-30),ctx.lineTo(VOLUME_MARGIN+16,canvas.height-36),ctx.lineTo(VOLUME_MARGIN+16,canvas.height-14),ctx.lineTo(VOLUME_MARGIN+6,canvas.height-20),ctx.lineTo(VOLUME_MARGIN,canvas.height-20),ctx.closePath(),ctx.fill();let Y=video.muted?0:video.volume;ctx.lineWidth=2,Y>0?(ctx.strokeStyle="lightgray",ctx.beginPath(),ctx.arc(VOLUME_MARGIN+18,canvas.height-25,4,-Math.PI/2+.3,Math.PI/2-.3),ctx.stroke(),Y>.4?ctx.strokeStyle="lightgray":ctx.strokeStyle="rgb(70, 70, 70)",ctx.beginPath(),ctx.arc(VOLUME_MARGIN+18,canvas.height-25,8,-Math.PI/2+.5,Math.PI/2-.5),ctx.stroke(),Y>.7?ctx.strokeStyle="lightgray":ctx.strokeStyle="rgb(70, 70, 70)",ctx.beginPath(),ctx.arc(VOLUME_MARGIN+18,canvas.height-25,12,-Math.PI/2+.6,Math.PI/2-.6),ctx.stroke()):(ctx.strokeStyle="rgb(180, 180, 180)",ctx.beginPath(),ctx.moveTo(VOLUME_MARGIN+20,canvas.height-30),ctx.lineTo(VOLUME_MARGIN+30,canvas.height-20),ctx.moveTo(VOLUME_MARGIN+20,canvas.height-20),ctx.lineTo(VOLUME_MARGIN+30,canvas.height-30),ctx.stroke()),ctx.lineWidth=3,ctx.strokeStyle="gray",ctx.beginPath(),ctx.moveTo(VOLUME_MARGIN+42,canvas.height-25),ctx.lineTo(VOLUME_MARGIN+112,canvas.height-25),ctx.stroke(),ctx.strokeStyle="white",ctx.beginPath(),ctx.moveTo(VOLUME_MARGIN+42,canvas.height-25),ctx.lineTo(VOLUME_MARGIN+42+70*Y,canvas.height-25),ctx.fillStyle="white",ctx.stroke(),ctx.beginPath(),ctx.arc(VOLUME_MARGIN+42+70*Y,canvas.height-25,5,0,2*Math.PI),ctx.fill();let D=canvas.height-38;if(onPlayBackTrigger&&!dragSeekBar&&!dragVolumeControl||pressPlayBackTrigger?ctx.fillStyle="rgb(90, 90, 90)":ctx.fillStyle="rgb(50, 50, 50)",ctx.fillRect(theaterMargin,D,40,25),ctx.font='13px "Arial"',ctx.textAlign="left",pressPlayBackTrigger)for(let O=1;O<8;O++){onPlayBacks[7-O]?ctx.fillStyle="rgb(110, 110, 110)":video.playbackRate.toFixed(1)===(.6+.2*O).toFixed(1)?ctx.fillStyle="rgb(90, 90, 90)":ctx.fillStyle="rgb(50, 50, 50)";let W=canvas.height-38-25*O;ctx.fillRect(theaterMargin,W,40,25),onPlayBacks[7-O]||video.playbackRate.toFixed(1)===(.6+.2*O).toFixed(1)?ctx.fillStyle="white":ctx.fillStyle="rgb(200, 200, 200)";let G=canvas.height-20-25*O;ctx.fillText("x"+(.6+.2*O).toFixed(1),theaterMargin+8,G)}ctx.lineWidth=1,ctx.strokeStyle="rgb(120, 120, 120)",ctx.strokeRect(theaterMargin,D,40,25),isNarrowCanvas||(ctx.fillStyle="white",ctx.font='13px "Arial"',ctx.textAlign="left",ctx.fillText("Speed：",theaterMargin-55,canvas.height-20)),ctx.fillStyle="white",ctx.fillText("x"+video.playbackRate.toFixed(1),theaterMargin+8,canvas.height-20);let N=canvas.height-30,H=canvas.height-55-37;!onFullscreen||dragSeekBar||dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.fillStyle=P,ctx.fillRect(fullscreenMargin-15,H,57,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText(isFullscreenMode?"Exit [F]":"Full [F]",fullscreenMargin-10,H+18)),ctx.lineWidth=3,isFullscreenMode?(ctx.beginPath(),ctx.moveTo(fullscreenMargin,N),ctx.lineTo(fullscreenMargin+8,N),ctx.lineTo(fullscreenMargin+8,N-5),ctx.moveTo(fullscreenMargin+22,N-5),ctx.lineTo(fullscreenMargin+22,N),ctx.lineTo(fullscreenMargin+30,N),ctx.moveTo(fullscreenMargin+30,N+10),ctx.lineTo(fullscreenMargin+22,N+10),ctx.lineTo(fullscreenMargin+22,N+15),ctx.moveTo(fullscreenMargin+8,N+15),ctx.lineTo(fullscreenMargin+8,N+10),ctx.lineTo(fullscreenMargin,N+10),ctx.stroke()):(ctx.beginPath(),ctx.moveTo(fullscreenMargin,N),ctx.lineTo(fullscreenMargin,N-6),ctx.lineTo(fullscreenMargin+10,N-6),ctx.moveTo(fullscreenMargin+20,N-6),ctx.lineTo(fullscreenMargin+30,N-6),ctx.lineTo(fullscreenMargin+30,N),ctx.moveTo(fullscreenMargin+30,N+9),ctx.lineTo(fullscreenMargin+30,N+15),ctx.lineTo(fullscreenMargin+20,N+15),ctx.moveTo(fullscreenMargin+10,N+15),ctx.lineTo(fullscreenMargin,N+15),ctx.lineTo(fullscreenMargin,N+9),ctx.stroke());let U="";if(video.duration>0){let z=Math.floor((video.duration-0)/60),K=Math.floor((video.duration-0)%60),q=Math.floor(video.currentTime/60),Z=Math.floor(video.currentTime%60);U+=q<10?"0"+q+":":q+":",U+=Z<10?"0"+Z:Z,isNarrowCanvas||(U+=" / ",U+=z<10?"0"+z+":":z+":",U+=K<10?"0"+K:K)}else U=isNarrowCanvas?"00:00":"00:00 / 00:00";ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="right",ctx.fillText(U,canvas.width-20,canvas.height-20)}if(ctx.globalAlpha=1,videoLoading&&!playAnime&&!pauseAnime&&!stepBackAnime&&!stepForwardAnime){if(bufCurrentTime!==video.currentTime)videoLoading=!1;else{ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height);let j,J=0;80==++loadAnimeIndex&&(loadAnimeIndex=0);for(let Q=0;Q<2*Math.PI;Q+=Math.PI/4)j=14-(loadAnimeIndex/10+J++)%8*1.5,ctx.fillStyle="rgba(255, 255, 255, "+j/30+")",ctx.beginPath(),ctx.arc(canvas.width/2+60*Math.cos(Q),canvas.height/2-60*Math.sin(Q),j,0,2*Math.PI),ctx.fill()}}ctx.lineWidth=3,ctx.strokeStyle="black",ctx.strokeRect(0,0,canvas.width,canvas.height),requestAnimationFrame(draw)}function flipPlayPauseVideo(){playing?(video.pause(),playAnime=!1,pauseAnime=!0,playing=!1,fading=!1,stopCount=100):(video.currentTime===video.duration-.17&&(video.currentTime=0),video.play(),playAnime=!0,pauseAnime=!1,playing=!0,onCanvas||(fading=!0,fadeAlpha=100)),stepBackAnime=!1,stepForwardAnime=!1,alpha=.6}function stepBack(){video.currentTime=Math.max(0,video.currentTime-10),playAnime=!1,pauseAnime=!1,stepBackAnime=!0,stepForwardAnime=!1,alpha=.6}function stepForward(){video.currentTime<video.duration&&(video.currentTime=Math.min(video.duration-.17,video.currentTime+10),video.currentTime===video.duration-.17&&playing&&flipPlayPauseVideo()),playAnime=!1,pauseAnime=!1,stepBackAnime=!1,stepForwardAnime=!0,alpha=.6}function keyDown(e){switch(e.key){case" ":e.preventDefault(),flipPlayPauseVideo();break;case"ArrowRight":e.preventDefault(),stepForward();break;case"ArrowLeft":e.preventDefault(),stepBack();break;case"ArrowUp":e.preventDefault(),video.muted&&(video.muted=!1,video.volume=0),video.volume>.9?video.volume=1:(video.volume+=.1,video.volume>.99&&(video.volume=1));break;case"ArrowDown":e.preventDefault(),video.volume<.1?video.volume=0:(video.volume-=.1,video.volume<.01&&(video.volume=0));break;case"m":video.muted=!video.muted;break;case"f":case"F":e.preventDefault(),toggleFullscreen()}}function mouseClick(e){if(-1!==getMouseX(e)&&-1!==getMouseY(e)){if(finished){onReplay&&(finished=!1,video.currentTime=0,video.play(),playing=!0,playAnime=!0,pauseAnime=!1,alpha=.6);return}if(press=!1,drag){drag=!1;return}if(dragSeekBar){dragSeekBar=!1,pressSeekBar=!1,resume&&video.play(),playing&&(bufCurrentTime=video.currentTime,videoLoading=!0);return}if(pressSeekBar){pressSeekBar=!1,resume&&video.play(),playing&&(bufCurrentTime=video.currentTime,videoLoading=!0);return}if(dragVolumeControl||onVolumeControl){dragVolumeControl=!1,onVolumeControl=!1;return}if(dragOnController){dragOnController=!1,pressOnContoroller=!1;return}if(pressPlayBackTrigger){for(let t=0;t<7;t++)if(onPlayBacks[t]){video.playbackRate=2-.2*t,onPlayBacks[t]=!1,pressPlayBackTrigger=!1,onPlayBackTrigger=!1;return}}else if(onPlayBackTrigger){pressPlayBackTrigger=!pressPlayBackTrigger;return}pressPlayBackTrigger=!1,mouseMoveY>0&&canvas.height-mouseMoveY>65?(flipPlayPauseVideo(),onPlayBackTrigger=!1,playing):onPlayPause?(flipPlayPauseVideo(),onPlayBackTrigger=!1):onStepBack&&600>=!canvas.width?(stepBack(),onPlayBackTrigger=!1):onStepForward&&600>=!canvas.width?(stepForward(),onPlayBackTrigger=!1):onFaceTrace?(onPlayBackTrigger=!1,faceTrace=!faceTrace):onVolume?(video.muted=!video.muted,onPlayBackTrigger=!1):onTheater?(flipTheaterMode(),onPlayBackTrigger=!1):onFullscreen&&(toggleFullscreen(),onPlayBackTrigger=!1)}}function mouseDown(e){if(!finished&&-1!==getMouseX(e)&&-1!==getMouseY(e)){if(!(pressPlayBackTrigger&&mouseMoveX>theaterMargin&&mouseMoveX<theaterMargin+40&&mouseMoveY>canvas.height-213&&getMouseY(e)<canvas.height-10))if(8>Math.abs(canvas.height-55-mouseMoveY)){resume=playing,video.pause(),pressSeekBar=!0;let t=((mouseDragX=getMouseX(e))-20)/(canvas.width-40);t=Math.max(0,Math.min(1,t)),video.currentTime=(video.duration-.17)*t}else if(mouseMoveX>VOLUME_MARGIN+40&&mouseMoveX<VOLUME_MARGIN+115&&mouseMoveY>canvas.height-35&&mouseMoveY<canvas.height-15){video.muted=!1,onVolumeControl=!0;let a=((mouseDragX=getMouseX(e))-VOLUME_MARGIN-42)/70;a=Math.max(0,Math.min(1,a)),video.volume=a}else canvas.height-mouseMoveY>55?(coordLeftBuf=coordLeft,coordTopBuf=coordTop,press=!0):pressOnContoroller=!0}}function mouseUp(e){pressOnContoroller=!1,press=!1}function mouseOut(){returnScroll(),onCanvas=!1,press=!1,pressSeekBar=!1,dragSeekBar=!1,onVolumeControl=!1,dragVolumeControl=!1,offAllFlags(),document.body.style.cursor="auto",playing&&(fading=!0,fadeAlpha=50),finished&&(onReplay=!1)}function mouseOver(){noScroll(),onCanvas=!0,fadeAlpha=50,fading=!1}function mouseMove(e){if(mouseXanytime=getMouseX(e),mouseYanytime=getMouseY(e),-1===mouseXanytime||-1===mouseYanytime){document.body.style.cursor="auto",offAllFlags();return}if(finished){mouseMoveX=getMouseX(e),mouseMoveY=getMouseY(e);let t=(canvas.width-200)/2;mouseMoveX>t&&mouseMoveX<t+200&&mouseMoveY>replayPosY&&mouseMoveY<replayPosY+replayHeight?(onReplay=!0,document.body.style.cursor="pointer"):(onReplay=!1,document.body.style.cursor="auto");return}if(onCanvas||(onCanvas=!0),fading=!1,stopCount=100,onMediaControl=!!(getMouseY(e)>canvas.height-55-10&&getMouseY(e)<canvas.height),dragOnController=pressOnContoroller&&(getMouseX(e)!==mouseMoveX||getMouseY(e)!==mouseMoveY),pressSeekBar){dragSeekBar=!0;let a=((mouseDragX=getMouseX(e))-20)/(canvas.width-40);a=Math.max(0,Math.min(1,a)),video.currentTime=(video.duration-.17)*a}else if(onVolumeControl){dragVolumeControl=!0;let o=((mouseDragX=getMouseX(e))-VOLUME_MARGIN-42)/70;o=Math.max(0,Math.min(1,o)),video.volume=o;return}if(press){if(mouseDragX=getMouseX(e),mouseDragY=getMouseY(e),mouseDragX===mouseMoveX&&mouseDragY===mouseMoveY||(drag=!0,1===videoScale))return;coordLeft=coordLeftBuf+(mouseMoveX-mouseDragX)/videoScale,coordTop=coordTopBuf+(mouseMoveY-mouseDragY)/videoScale,coordLeft=Math.max(0,Math.min(canvas.width-coordWidth,coordLeft)),coordTop=Math.max(0,Math.min(canvas.height-coordHeight,coordTop))}else if(!dragOnController){drag=!1,mouseMoveX=getMouseX(e),mouseMoveY=getMouseY(e);let i=canvas.height-213,l=canvas.height-10;pressPlayBackTrigger&&mouseMoveX>theaterMargin&&mouseMoveX<theaterMargin+40&&mouseMoveY>i&&getMouseY(e)<l?(document.body.style.cursor="pointer",offAllFlags(),onPlayBackTrigger=!0,onPlayBacks[Math.floor((mouseMoveY-i)/25)]=!0):8>Math.abs(canvas.height-55-mouseMoveY)?(document.body.style.cursor="pointer",onSeekBar||(seekBallRad=0),offAllFlags(),onSeekBar=!0):mouseMoveX>20&&mouseMoveX<65&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),onPlayPause=!0):!isNarrowCanvas&&mouseMoveX>80&&mouseMoveX<108&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),onStepBack=!0):!isNarrowCanvas&&mouseMoveX>130&&mouseMoveX<158&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),onStepForward=!0):mouseMoveX>VOLUME_MARGIN-7&&mouseMoveX<VOLUME_MARGIN+32&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),onVolume=!0):mouseMoveX>VOLUME_MARGIN+40&&mouseMoveX<VOLUME_MARGIN+115&&mouseMoveY>canvas.height-35&&mouseMoveY<canvas.height-15?document.body.style.cursor="pointer":mouseMoveX>325&&mouseMoveX<353&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),onFaceTrace=!0):mouseMoveX>theaterMargin&&mouseMoveX<theaterMargin+40&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height-10?(document.body.style.cursor="pointer",offAllFlags(),onPlayBackTrigger=!0):mouseMoveX>fullscreenMargin-6&&mouseMoveX<fullscreenMargin+36&&mouseMoveY>canvas.height-55+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),onFullscreen=!0):(document.body.style.cursor="auto",offAllFlags())}}function getDrawingArea(){let e=canvas.getBoundingClientRect(),t=canvas.width/canvas.height,a=e.width/e.height,o,i,l,n;return a>t?(o=(i=e.height)*t,l=(e.width-o)/2,n=0):(i=(o=e.width)/t,l=0,n=(e.height-i)/2),{rect:e,drawWidth:o,drawHeight:i,offsetX:l,offsetY:n}}function isClickInMargin(e){let t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!t)return!1;let{rect:a,drawWidth:o,drawHeight:i,offsetX:l,offsetY:n}=getDrawingArea(),c=e.clientX-a.left,r=e.clientY-a.top;return c<l||c>l+o||r<n||r>n+i}function getMouseX(e){if(isClickInMargin(e))return -1;let t=e.target.getBoundingClientRect(),a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!a)return e.clientX-t.left;{let{drawWidth:o,offsetX:i}=getDrawingArea(),l=canvas.width/o;return(e.clientX-t.left-i)*l}}function getMouseY(e){if(isClickInMargin(e))return -1;let t=e.target.getBoundingClientRect(),a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!a)return e.clientY-t.top;{let{drawHeight:o,offsetY:i}=getDrawingArea(),l=canvas.height/o;return(e.clientY-t.top-i)*l}}function offAllFlags(){onSeekBar=!1,onPlayPause=!1,onStepBack=!1,onStepForward=!1,onFaceTrace=!1,onVolume=!1,onVolumeControl=!1,onTheater=!1,onPlayBackTrigger=!1,onFullscreen=!1,onPlayBacks.fill(!1)}msieversion(),video.addEventListener("waiting",function(e){bufCurrentTime=video.currentTime,videoLoading=!0}),video.addEventListener("canplay",function(e){videoLoading=!1}),video.addEventListener("loadedmetadata",function(e){VIDEO_WIDTH=video.videoWidth||1920,VIDEO_HEIGHT=video.videoHeight||1080,metadataLoaded?init():(metadataLoaded=!0,init(),draw())}),video.addEventListener("loadeddata",function(e){playing||draw()});let mousePrevX=-1,timeStamp=0;function canvasZoom(e){if(finished)return;mouseX=getMouseX(e),mouseY=getMouseY(e),-1==mousePrevX&&(mousePrevX=mouseX);let t=!0;if(e.timeStamp-timeStamp<30)return;timeStamp=e.timeStamp;let a=e.wheelDelta>0;if(a)(videoScale=1+.2*++videoScaleIndex)>5&&(videoScale=5,videoScaleIndex--,t=!1);else if((videoScale=1+.2*--videoScaleIndex)<1){videoScale=1,videoScaleIndex=0,coordLeft=0,coordWidth=canvas.width,coordTop=0,coordHeight=canvas.height;return}if(t){let o=.2/(videoScale*(videoScale+(a?-.2:.2)));coordLeft+=a?mouseX*o:-(mouseX*o),coordTop+=a?mouseY*o:-(mouseY*o),coordWidth=canvas.width/videoScale,coordHeight=canvas.height/videoScale,coordLeft=Math.max(0,Math.min(canvas.width-coordWidth,coordLeft)),coordTop=Math.max(0,Math.min(canvas.height-coordHeight,coordTop))}t&&(imageDifX=coordLeft+coordWidth*mouseX/canvas.width,imageDifY=coordTop+coordHeight*mouseY/canvas.height,imageDifX<0&&(imageDifX=0),imageDifX>canvas.width&&(imageDifX=canvas.width),imageDifY<0&&(imageDifY=0),imageDifY>canvas.height&&(imageDifY=canvas.height)),mousePrevX=mouseX}function toggleFullscreen(){if(isFullscreenMode){cancelFullScreen(),isFullscreenMode=!1;let e=document.getElementById("main");e&&(e.style.background="white"),canvas&&(canvas.style.maxWidth=originalMaxWidth)}else{scrollPosBuf=window.pageYOffset,canvasWidthBuf=canvas.clientWidth,goFullScreen(canvas),isFullscreenMode=!0;let t=0;t=window.innerWidth*VIDEO_HEIGHT/VIDEO_WIDTH<=window.innerHeight?window.innerWidth:window.innerHeight*VIDEO_WIDTH/VIDEO_HEIGHT-10,canvas&&(canvas.style.maxWidth=t+"px")}onFullscreen=!1,init()}let scrollPosBuf=0,canvasWidthBuf=0;function flipTheaterMode(){if(theaterMode){cancelFullScreen(canvas),theaterTmp=!0,theaterMode=!1;let e=document.getElementById("main");e&&(e.style.background="white"),canvas&&(canvas.style.maxWidth=originalMaxWidth)}else{scrollPosBuf=window.pageYOffset,canvasWidthBuf=canvas.clientWidth,goFullScreen(canvas);let t=0;t=window.innerWidth*VIDEO_HEIGHT/VIDEO_WIDTH<=window.innerHeight?window.innerWidth:window.innerHeight*VIDEO_WIDTH/VIDEO_HEIGHT-10,canvas&&(canvas.style.maxWidth=t+"px"),theaterMode=!0}onTheater=!1}function noScroll(){document.addEventListener("mousewheel",scrollControl,{passive:!1})}function returnScroll(){document.removeEventListener("mousewheel",scrollControl,{passive:!1})}function scrollControl(e){e.preventDefault()}function eventFullScreen(e){document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1)}function enabledFullScreen(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen||document.msFullscreenEnabled}function goFullScreen(e){let t=window.document,a=null===e?t.documentElement:e;(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||a.msRequestFullscreen).call(a)}function cancelFullScreen(){let e=window.document,t=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;t.call(e)}function getFullScreenObject(){let e=window.document,t=e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement;return t}function isFullScreen(){return void 0!==document.FullscreenElement&&null!==document.FullscreenElement||void 0!==document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement}if(video&&(video.width=0,video.height=0),canvas){if(canvas.style.maxWidth&&""!==canvas.style.maxWidth)originalMaxWidth=canvas.style.maxWidth;else{let e=window.getComputedStyle(canvas);e.maxWidth&&"none"!==e.maxWidth&&(originalMaxWidth=e.maxWidth)}canvas.style.display="block",canvas.style.margin="0 auto"}"undefined"==typeof captions&&(window.captions=[]),"undefined"==typeof debug&&(window.debug=!1),VIDEO_WIDTH=video.videoWidth||1920,VIDEO_HEIGHT=video.videoHeight||1080,metadataLoaded=!0,init(),draw();