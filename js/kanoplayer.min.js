"use strict";const KP={elements:{video:null,canvas:null,ctx:null},config:{MAX_ALPHA:.6,MAX_SCALE:5,VIDEO_PADDING:0,DURATION_DIF:.17,SEEKBAR_HEIGHT:55,SEEKBAR_MARGIN:20,PLAY_PAUSE_MARGIN:35,STEP_BACK_MARGIN:95,STEP_FORWARD_MARGIN:145,VOLUME_MARGIN_NORMAL:185,FACE_TRACE_MARGIN:340,FULLSCREEN_MARGIN:390},video:{WIDTH:1920,HEIGHT:1080,scale:1,scaleIndex:0,loading:!0,bufCurrentTime:0,metadataLoaded:!1},mouse:{press:!1,drag:!1,x:500,y:150,moveX:0,moveY:0,dragX:0,dragY:0,xAnytime:0,yAnytime:0,imageDifX:0,imageDifY:0,prevX:-1},coords:{left:0,width:0,top:0,height:0,leftBuf:0,topBuf:0},animation:{play:!1,pause:!1,stepBack:!1,stepForward:!1,alpha:0,loadIndex:0,fadeAlpha:0,seekBallRad:0,stopCount:100},playback:{playing:!1,finished:!1,resume:!1},ui:{onCanvas:!1,onSeekBar:!1,pressSeekBar:!1,dragSeekBar:!1,onPlayPause:!1,onStepBack:!1,onStepForward:!1,onVolume:!1,onVolumeControl:!1,dragVolumeControl:!1,onTheater:!1,theaterMode:!1,theaterTmp:!1,onFullscreen:!1,isFullscreenMode:!1,onFaceTrace:!1,faceTrace:!1,onReplay:!1,fading:!1,pressOnController:!1,dragOnController:!1,onMediaControl:!1,onPlayBackTrigger:!1,pressPlayBackTrigger:!1,onPlayBacks:[!1,!1,!1,!1,!1,!1,!1],onVideoRate0_7:!1,onVideoRate1_0:!1,onVideoRate1_5:!1,onVideoRate2_0:!1},layout:{VOLUME_MARGIN:0,theaterMargin:0,fullscreenMargin:0,isNarrowCanvas:!1,replayPosY:0,replayHeight:0,originalMaxWidth:"1200px",scrollPosBuf:0,canvasWidthBuf:0},system:{timeStamp:0}};KP.elements.video=document.getElementById("myVideo")||document.querySelector("video")||(console.error("Kano Player: No video element found."),null),KP.elements.canvas=document.getElementById("myCanvas")||document.querySelector("canvas")||(console.error("Kano Player: No canvas element found."),null),KP.elements.canvas.oncontextmenu=function(){return!1},KP.elements.ctx=KP.elements.canvas?KP.elements.canvas.getContext("2d"):null;const video=KP.elements.video,canvas=KP.elements.canvas,ctx=KP.elements.ctx;function handleFSevent(){let e=void 0!==document.FullscreenElement&&null!==document.FullscreenElement||void 0!==document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement;if(KP.ui.theaterMode&&!e&&(KP.ui.theaterTmp=!0,KP.ui.theaterMode=!1,init()),KP.ui.isFullscreenMode&&!e){KP.ui.isFullscreenMode=!1;let t=document.getElementById("main");t&&(t.style.background="white"),canvas&&(canvas.style.maxWidth=KP.layout.originalMaxWidth),init()}}function init(){canvas.width=KP.ui.theaterTmp?KP.layout.canvasWidthBuf:canvas.clientWidth,canvas.height=canvas.width*KP.video.HEIGHT/KP.video.WIDTH+KP.config.VIDEO_PADDING,KP.coords.left=0,KP.coords.width=canvas.width,KP.coords.top=0,KP.coords.height=canvas.height-KP.config.VIDEO_PADDING,KP.video.scale=1,KP.video.scaleIndex=0,KP.layout.isNarrowCanvas=canvas.width<=600,KP.layout.isNarrowCanvas?(KP.layout.VOLUME_MARGIN=KP.config.SEEKBAR_MARGIN+30+20,KP.layout.theaterMargin=KP.layout.VOLUME_MARGIN+120+15,KP.layout.fullscreenMargin=KP.layout.theaterMargin+40+15):(KP.layout.VOLUME_MARGIN=KP.layout.VOLUME_MARGIN_NORMAL,KP.layout.theaterMargin=canvas.width-220,KP.layout.fullscreenMargin=canvas.width-160),KP.layout.replayPosY=(canvas.height-80)/2,KP.layout.replayHeight=80,KP.ui.theaterTmp&&(scrollTo(0,KP.layout.scrollPosBuf),KP.ui.theaterTmp=!1)}function draw(){ctx.globalAlpha=1,ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.translate(0,0),ctx.scale(KP.video.scale,KP.video.scale),ctx.drawImage(video,-KP.coords.left,-KP.coords.top+KP.config.VIDEO_PADDING/2,canvas.width,canvas.height-KP.config.VIDEO_PADDING);for(let e=0;e<captions.length;e++){let t=captions[e],a=void 0!==t.startTime?t.startTime:t[0],i=void 0!==t.endTime?t.endTime:t[1];if(video.currentTime>=a&&video.currentTime<i&&void 0!==t.text){let o=(t.fontSize||20)*(canvas.width/1124),n=void 0!==t.align?t.align:"center",l=void 0!==t.positionX?t.positionX:.5,c=void 0!==t.positionY?t.positionY:.5,r=t.textColor||"white",s=t.strokeColor||"black",P=void 0!==t.strokeWidth?t.strokeWidth:0;ctx.font=(t.bold?"bold ":"")+o+'px "Meiryo", sans-serif',ctx.textAlign=n;let u=t.text.split("\n");if(t.backgroundColor){let K=0,g=0;for(let d=0;d<u.length;d++)g=Math.max(g,ctx.measureText(u[d]).width);K="left"===n?0:"center"===n?g/2:g,ctx.fillStyle=t.backgroundColor,ctx.fillRect(canvas.width*l-KP.coords.left-K-10,(canvas.height-KP.config.VIDEO_PADDING)*c-KP.coords.top-1.3*o/2-2.5,g+20,1.3*o*u.length+10)}for(let h=0;h<u.length;h++){let $=u[h],v=o/2;h>0&&(v+=1.3*o*h);let m=canvas.width*l-KP.coords.left,f=(canvas.height-KP.config.VIDEO_PADDING)*c-KP.coords.top+v;P>0&&(ctx.strokeStyle=s,ctx.lineWidth=P,ctx.strokeText($,m,f)),ctx.fillStyle=r,ctx.fillText($,m,f)}}}if(ctx.restore(),debug&&(ctx.font='bold 20px "Meiryo", sans-serif',ctx.fillStyle="white",ctx.textAlign="left",ctx.fillText("time: "+video.currentTime.toFixed("2"),10,20),ctx.fillText("("+(KP.mouse.moveX/canvas.width).toFixed(2)+", "+(KP.mouse.moveY/canvas.height).toFixed(2)+")",10,40)),ctx.textAlign="right",KP.playback.finished){KP.ui.theaterMode&&flipTheaterMode();let x=ctx.createRadialGradient(canvas.width/2,canvas.height/2,0,canvas.width/2,canvas.height/2,Math.max(canvas.width,canvas.height)/2);x.addColorStop(0,"rgba(0, 0, 0, 0.7)"),x.addColorStop(1,"rgba(0, 0, 0, 0.9)"),ctx.fillStyle=x,ctx.fillRect(0,0,canvas.width,canvas.height),ctx.shadowColor="rgba(0, 0, 0, 0.5)",ctx.shadowBlur=20,ctx.shadowOffsetX=0,ctx.shadowOffsetY=10;let y=(canvas.width-200)/2,_=(canvas.height-80)/2,E=ctx.createLinearGradient(y,_,y,_+80);KP.ui.onReplay?(E.addColorStop(0,"rgba(70, 70, 70, 0.9)"),E.addColorStop(1,"rgba(50, 50, 50, 0.9)")):(E.addColorStop(0,"rgba(60, 60, 60, 0.8)"),E.addColorStop(1,"rgba(40, 40, 40, 0.8)")),ctx.fillStyle=E,ctx.beginPath(),ctx.roundRect(y,_,200,80,15),ctx.fill(),ctx.shadowColor="transparent",ctx.shadowBlur=0,ctx.strokeStyle=KP.ui.onReplay?"rgba(255, 255, 255, 0.4)":"rgba(255, 255, 255, 0.2)",ctx.lineWidth=2,ctx.stroke(),ctx.fillStyle=KP.ui.onReplay?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.7)";let A=y+50,p=_+40;ctx.lineWidth=3,ctx.strokeStyle=ctx.fillStyle,ctx.beginPath(),ctx.arc(A,p,20,-Math.PI/2-.8,Math.PI/2+1.2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(A-20+5,p-20-3),ctx.lineTo(A-20+15,p-20+7),ctx.lineTo(A-20-5,p-20+10),ctx.closePath(),ctx.fill(),ctx.fillStyle=KP.ui.onReplay?"rgba(255, 255, 255, 0.9)":"rgba(255, 255, 255, 0.7)",ctx.font='bold 26px "Arial"',ctx.textAlign="left",ctx.fillText("Replay",A+40,p+8),requestAnimationFrame(draw);return}if(KP.animation.play?(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-KP.animation.alpha)/2,.3+(.6-KP.animation.alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+KP.animation.alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.fillStyle="rgba(255, 255, 255, "+KP.animation.alpha+")",ctx.beginPath(),ctx.moveTo(-30,-45),ctx.lineTo(50,0),ctx.lineTo(-30,45),ctx.closePath(),ctx.fill(),KP.animation.alpha-=.02,KP.animation.alpha<0&&(KP.animation.play=!1),ctx.restore()):KP.animation.pause?(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-KP.animation.alpha)/2,.3+(.6-KP.animation.alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+KP.animation.alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.lineWidth=22,ctx.strokeStyle="rgba(255, 255, 255, "+KP.animation.alpha+")",ctx.beginPath(),ctx.moveTo(-23,-45),ctx.lineTo(-23,45),ctx.moveTo(23,-45),ctx.lineTo(23,45),ctx.stroke(),KP.animation.alpha-=.02,KP.animation.alpha<0&&(KP.animation.pause=!1),ctx.restore()):KP.animation.stepBack?(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-KP.animation.alpha)/2,.3+(.6-KP.animation.alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+KP.animation.alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.strokeStyle="rgba(255, 255, 255, "+KP.animation.alpha+")",ctx.lineWidth=12,ctx.beginPath(),ctx.arc(0,0,55,-Math.PI/2-.61,Math.PI/2+1.2),ctx.stroke(),ctx.fillStyle="rgba(255, 255, 255, "+KP.animation.alpha+")",ctx.beginPath(),ctx.moveTo(-45,-60),ctx.lineTo(-18,-31),ctx.lineTo(-60,-20),ctx.closePath(),ctx.fill(),ctx.font='48px "Arial"',ctx.fillText("10",25,20),KP.animation.alpha-=.02,KP.animation.alpha<0&&(KP.animation.stepBack=!1),ctx.restore()):KP.animation.stepForward&&(ctx.save(),ctx.translate(canvas.width/2,canvas.height/2),ctx.scale(.3+(.6-KP.animation.alpha)/2,.3+(.6-KP.animation.alpha)/2),ctx.fillStyle="rgba(0, 0, 0, "+KP.animation.alpha+")",ctx.beginPath(),ctx.arc(0,0,100,0,2*Math.PI),ctx.fill(),ctx.strokeStyle="rgba(255, 255, 255, "+KP.animation.alpha+")",ctx.lineWidth=12,ctx.beginPath(),ctx.arc(0,0,55,-Math.PI/2+.61,Math.PI/2-1.2,!0),ctx.stroke(),ctx.fillStyle="rgba(255, 255, 255, "+KP.animation.alpha+")",ctx.beginPath(),ctx.moveTo(45,-60),ctx.lineTo(18,-31),ctx.lineTo(60,-20),ctx.closePath(),ctx.fill(),ctx.font='48px "Arial"',ctx.fillText("10",25,20),KP.animation.alpha-=.02,KP.animation.alpha<0&&(KP.animation.stepForward=!1),ctx.restore()),KP.ui.onCanvas&&!KP.ui.onMediaControl&&KP.playback.playing&&(KP.animation.stopCount--,0===KP.animation.stopCount&&(KP.ui.fading=!0,KP.animation.fadeAlpha=50)),KP.ui.onCanvas||!KP.playback.playing||KP.ui.fading){KP.ui.fading&&(0===KP.animation.fadeAlpha?(ctx.globalAlpha=0,KP.ui.onCanvas&&(document.body.style.cursor="none")):(KP.animation.fadeAlpha--,ctx.globalAlpha=Math.min(10,KP.animation.fadeAlpha)/10));let S="rgba(40, 40, 40, 0.6)",T=ctx.createLinearGradient(0,canvas.height-2*KP.config.SEEKBAR_HEIGHT,0,canvas.height);T.addColorStop(0,"rgba(0, 0, 0, 0)"),T.addColorStop(.4,"rgba(0, 0, 0, 0.1)"),T.addColorStop(.5,"rgba(0, 0, 0, 0.6)"),T.addColorStop(1,"rgba(0, 0, 0, 0.9)"),ctx.fillStyle=T,ctx.fillRect(0,canvas.height-2*KP.config.SEEKBAR_HEIGHT,canvas.width,2*KP.config.SEEKBAR_HEIGHT);let R=canvas.width-2*KP.config.SEEKBAR_MARGIN;if(KP.ui.onSeekBar||KP.ui.dragSeekBar?ctx.lineWidth=7:ctx.lineWidth=6,ctx.strokeStyle="rgba(180, 180, 180, 0.3)",ctx.beginPath(),ctx.moveTo(KP.config.SEEKBAR_MARGIN-.5,canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.lineTo(canvas.width-KP.config.SEEKBAR_MARGIN+.5,canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.stroke(),KP.ui.onSeekBar||KP.ui.dragSeekBar?ctx.lineWidth=5:ctx.lineWidth=4,ctx.strokeStyle="gray",ctx.beginPath(),ctx.moveTo(KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.lineTo(canvas.width-KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.stroke(),video.buffered.length>0){ctx.strokeStyle="lightgray";for(let M=0;M<video.buffered.length&&!(video.buffered.start(M)>video.currentTime);M++)video.buffered.end(M)<video.currentTime||(ctx.beginPath(),ctx.moveTo(KP.config.SEEKBAR_MARGIN+R*video.currentTime/(video.duration-KP.config.DURATION_DIF),canvas.height-KP.config.SEEKBAR_HEIGHT),video.buffered.end(M)===video.duration?ctx.lineTo(KP.config.SEEKBAR_MARGIN+R*(video.buffered.end(M)-KP.config.DURATION_DIF)/(video.duration-KP.config.DURATION_DIF),canvas.height-KP.config.SEEKBAR_HEIGHT):ctx.lineTo(KP.config.SEEKBAR_MARGIN+R*video.buffered.end(M)/(video.duration-KP.config.DURATION_DIF),canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.stroke())}if(ctx.strokeStyle="red",ctx.beginPath(),ctx.moveTo(KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.lineTo(KP.config.SEEKBAR_MARGIN+R*video.currentTime/(video.duration-KP.config.DURATION_DIF),canvas.height-KP.config.SEEKBAR_HEIGHT),ctx.stroke(),(KP.ui.onSeekBar||KP.ui.dragSeekBar)&&!KP.ui.dragVolumeControl?(KP.animation.seekBallRad<6&&KP.animation.seekBallRad++,ctx.fillStyle="red",ctx.beginPath(),ctx.arc(KP.config.SEEKBAR_MARGIN+R*video.currentTime/(video.duration-KP.config.DURATION_DIF),canvas.height-KP.config.SEEKBAR_HEIGHT,KP.animation.seekBallRad,0,2*Math.PI),ctx.fill()):KP.animation.seekBallRad>0&&(KP.animation.seekBallRad--,ctx.fillStyle="red",ctx.beginPath(),ctx.arc(KP.config.SEEKBAR_MARGIN+R*video.currentTime/(video.duration-KP.config.DURATION_DIF),canvas.height-KP.config.SEEKBAR_HEIGHT,KP.animation.seekBallRad,0,2*Math.PI),ctx.fill()),video.currentTime>=video.duration-KP.config.DURATION_DIF&&!video.onwaiting&&(video.currentTime=video.duration,KP.playback.playing&&flipPlayPauseVideo(),KP.playback.finished=!0),(KP.ui.onSeekBar||KP.ui.dragSeekBar)&&!KP.ui.dragVolumeControl){let I=(KP.mouse.moveX-KP.config.SEEKBAR_MARGIN)/(canvas.width-2*KP.config.SEEKBAR_MARGIN),k=0;(I=R*Math.max(0,Math.min(1,I)))-7<KP.config.SEEKBAR_MARGIN?k=KP.config.SEEKBAR_MARGIN-I+7:I+27>canvas.width-2*KP.config.SEEKBAR_MARGIN&&(k=canvas.width-2*KP.config.SEEKBAR_MARGIN-I-27),ctx.fillStyle=S,ctx.fillRect(k+I-27+KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT-37,54,27);let B=(KP.mouse.moveX-KP.config.SEEKBAR_MARGIN)/(canvas.width-2*KP.config.SEEKBAR_MARGIN),b=Math.floor((B=(video.duration-KP.config.DURATION_DIF)*Math.max(0,Math.min(1,B)))/60),G=Math.floor(B%60),w="";w+=b<10?"0"+b+":":b+":",w+=G<10?"0"+G:G,ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="center",ctx.fillText(w,k+I+KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT-18)}!KP.ui.onPlayPause||KP.ui.dragSeekBar||KP.ui.dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",KP.playback.playing?(ctx.fillStyle=S,ctx.fillRect(KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT-37,94,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("Stop [space]",KP.config.SEEKBAR_MARGIN+5,canvas.height-KP.config.SEEKBAR_HEIGHT-18)):(ctx.fillStyle=S,ctx.fillRect(KP.config.SEEKBAR_MARGIN,canvas.height-KP.config.SEEKBAR_HEIGHT-37,92,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("Play [space]",KP.config.SEEKBAR_MARGIN+5,canvas.height-KP.config.SEEKBAR_HEIGHT-18))),KP.playback.playing?(ctx.lineWidth=4,ctx.beginPath(),ctx.moveTo(KP.config.PLAY_PAUSE_MARGIN+3,canvas.height-35),ctx.lineTo(KP.config.PLAY_PAUSE_MARGIN+3,canvas.height-15),ctx.moveTo(KP.config.PLAY_PAUSE_MARGIN+13,canvas.height-35),ctx.lineTo(KP.config.PLAY_PAUSE_MARGIN+13,canvas.height-15),ctx.stroke()):(ctx.beginPath(),ctx.moveTo(KP.config.PLAY_PAUSE_MARGIN,canvas.height-35),ctx.lineTo(KP.config.PLAY_PAUSE_MARGIN+20,canvas.height-25),ctx.lineTo(KP.config.PLAY_PAUSE_MARGIN,canvas.height-15),ctx.closePath(),ctx.fill()),KP.layout.isNarrowCanvas||(!KP.ui.onStepBack||KP.ui.dragSeekBar||KP.ui.dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",ctx.fillStyle=S,ctx.fillRect(KP.config.STEP_BACK_MARGIN-45,canvas.height-KP.config.SEEKBAR_HEIGHT-37,100,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("10s back [←]",KP.config.STEP_BACK_MARGIN-40,canvas.height-KP.config.SEEKBAR_HEIGHT-18)),ctx.lineWidth=3,ctx.beginPath(),ctx.arc(KP.config.STEP_BACK_MARGIN,canvas.height-25,13,-Math.PI/2-.8,Math.PI/2+1.2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(KP.config.STEP_BACK_MARGIN-11,canvas.height-38),ctx.lineTo(KP.config.STEP_BACK_MARGIN-3,canvas.height-31),ctx.lineTo(KP.config.STEP_BACK_MARGIN-12,canvas.height-28),ctx.closePath(),ctx.fill(),ctx.font='11px "Arial"',ctx.textAlign="right",ctx.fillText("10",KP.config.STEP_BACK_MARGIN+6,canvas.height-20)),KP.layout.isNarrowCanvas||(!KP.ui.onStepForward||KP.ui.dragSeekBar||KP.ui.dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",ctx.fillStyle=S,ctx.fillRect(KP.config.STEP_FORWARD_MARGIN-45,canvas.height-KP.config.SEEKBAR_HEIGHT-37,120,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("10s forward [→]",KP.config.STEP_FORWARD_MARGIN-40,canvas.height-KP.config.SEEKBAR_HEIGHT-18)),ctx.lineWidth=3,ctx.beginPath(),ctx.arc(KP.config.STEP_FORWARD_MARGIN,canvas.height-25,13,-Math.PI/2+.8,Math.PI/2-1.2,!0),ctx.stroke(),ctx.beginPath(),ctx.moveTo(KP.config.STEP_FORWARD_MARGIN+11,canvas.height-38),ctx.lineTo(KP.config.STEP_FORWARD_MARGIN+3,canvas.height-31),ctx.lineTo(KP.config.STEP_FORWARD_MARGIN+12,canvas.height-28),ctx.closePath(),ctx.fill(),ctx.font='11px "Arial"',ctx.textAlign="right",ctx.fillText("10",KP.config.STEP_FORWARD_MARGIN+5,canvas.height-20)),!KP.ui.onVolume||KP.ui.dragSeekBar||KP.ui.dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.strokeStyle="white",ctx.fillStyle=S,ctx.fillRect(KP.layout.VOLUME_MARGIN-18,canvas.height-KP.config.SEEKBAR_HEIGHT-37,70,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText("Mute [m]",KP.layout.VOLUME_MARGIN-13,canvas.height-KP.config.SEEKBAR_HEIGHT-18)),ctx.beginPath(),ctx.moveTo(KP.layout.VOLUME_MARGIN,canvas.height-30),ctx.lineTo(KP.layout.VOLUME_MARGIN+6,canvas.height-30),ctx.lineTo(KP.layout.VOLUME_MARGIN+16,canvas.height-36),ctx.lineTo(KP.layout.VOLUME_MARGIN+16,canvas.height-14),ctx.lineTo(KP.layout.VOLUME_MARGIN+6,canvas.height-20),ctx.lineTo(KP.layout.VOLUME_MARGIN,canvas.height-20),ctx.closePath(),ctx.fill();let F=video.muted?0:video.volume;ctx.lineWidth=2,F>0?(ctx.strokeStyle="lightgray",ctx.beginPath(),ctx.arc(KP.layout.VOLUME_MARGIN+18,canvas.height-25,4,-Math.PI/2+.3,Math.PI/2-.3),ctx.stroke(),F>.4?ctx.strokeStyle="lightgray":ctx.strokeStyle="rgb(70, 70, 70)",ctx.beginPath(),ctx.arc(KP.layout.VOLUME_MARGIN+18,canvas.height-25,8,-Math.PI/2+.5,Math.PI/2-.5),ctx.stroke(),F>.7?ctx.strokeStyle="lightgray":ctx.strokeStyle="rgb(70, 70, 70)",ctx.beginPath(),ctx.arc(KP.layout.VOLUME_MARGIN+18,canvas.height-25,12,-Math.PI/2+.6,Math.PI/2-.6),ctx.stroke()):(ctx.strokeStyle="rgb(180, 180, 180)",ctx.beginPath(),ctx.moveTo(KP.layout.VOLUME_MARGIN+20,canvas.height-30),ctx.lineTo(KP.layout.VOLUME_MARGIN+30,canvas.height-20),ctx.moveTo(KP.layout.VOLUME_MARGIN+20,canvas.height-20),ctx.lineTo(KP.layout.VOLUME_MARGIN+30,canvas.height-30),ctx.stroke()),ctx.lineWidth=3,ctx.strokeStyle="gray",ctx.beginPath(),ctx.moveTo(KP.layout.VOLUME_MARGIN+42,canvas.height-25),ctx.lineTo(KP.layout.VOLUME_MARGIN+112,canvas.height-25),ctx.stroke(),ctx.strokeStyle="white",ctx.beginPath(),ctx.moveTo(KP.layout.VOLUME_MARGIN+42,canvas.height-25),ctx.lineTo(KP.layout.VOLUME_MARGIN+42+70*F,canvas.height-25),ctx.fillStyle="white",ctx.stroke(),ctx.beginPath(),ctx.arc(KP.layout.VOLUME_MARGIN+42+70*F,canvas.height-25,5,0,2*Math.PI),ctx.fill();let N=canvas.height-38;if(KP.ui.onPlayBackTrigger&&!KP.ui.dragSeekBar&&!KP.ui.dragVolumeControl||KP.ui.pressPlayBackTrigger?ctx.fillStyle="rgb(90, 90, 90)":ctx.fillStyle="rgb(50, 50, 50)",ctx.fillRect(KP.layout.theaterMargin,N,40,25),ctx.font='13px "Arial"',ctx.textAlign="left",KP.ui.pressPlayBackTrigger)for(let H=1;H<8;H++){KP.ui.onPlayBacks[7-H]?ctx.fillStyle="rgb(110, 110, 110)":video.playbackRate.toFixed(1)===(.6+.2*H).toFixed(1)?ctx.fillStyle="rgb(90, 90, 90)":ctx.fillStyle="rgb(50, 50, 50)";let C=canvas.height-38-25*H;ctx.fillRect(KP.layout.theaterMargin,C,40,25),KP.ui.onPlayBacks[7-H]||video.playbackRate.toFixed(1)===(.6+.2*H).toFixed(1)?ctx.fillStyle="white":ctx.fillStyle="rgb(200, 200, 200)";let D=canvas.height-20-25*H;ctx.fillText("x"+(.6+.2*H).toFixed(1),KP.layout.theaterMargin+8,D)}ctx.lineWidth=1,ctx.strokeStyle="rgb(120, 120, 120)",ctx.strokeRect(KP.layout.theaterMargin,N,40,25),KP.layout.isNarrowCanvas||(ctx.fillStyle="white",ctx.font='13px "Arial"',ctx.textAlign="left",ctx.fillText("Speed：",KP.layout.theaterMargin-55,canvas.height-20)),ctx.fillStyle="white",ctx.fillText("x"+video.playbackRate.toFixed(1),KP.layout.theaterMargin+8,canvas.height-20);let O=canvas.height-30,L=canvas.height-KP.config.SEEKBAR_HEIGHT-37;!KP.ui.onFullscreen||KP.ui.dragSeekBar||KP.ui.dragVolumeControl?(ctx.fillStyle="lightgray",ctx.strokeStyle="lightgray"):(ctx.fillStyle=S,ctx.fillRect(KP.layout.fullscreenMargin-15,L,57,27),ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="left",ctx.fillText(KP.ui.isFullscreenMode?"Exit [F]":"Full [F]",KP.layout.fullscreenMargin-10,L+18)),ctx.lineWidth=3,KP.ui.isFullscreenMode?(ctx.beginPath(),ctx.moveTo(KP.layout.fullscreenMargin,O),ctx.lineTo(KP.layout.fullscreenMargin+8,O),ctx.lineTo(KP.layout.fullscreenMargin+8,O-5),ctx.moveTo(KP.layout.fullscreenMargin+22,O-5),ctx.lineTo(KP.layout.fullscreenMargin+22,O),ctx.lineTo(KP.layout.fullscreenMargin+30,O),ctx.moveTo(KP.layout.fullscreenMargin+30,O+10),ctx.lineTo(KP.layout.fullscreenMargin+22,O+10),ctx.lineTo(KP.layout.fullscreenMargin+22,O+15),ctx.moveTo(KP.layout.fullscreenMargin+8,O+15),ctx.lineTo(KP.layout.fullscreenMargin+8,O+10),ctx.lineTo(KP.layout.fullscreenMargin,O+10),ctx.stroke()):(ctx.beginPath(),ctx.moveTo(KP.layout.fullscreenMargin,O),ctx.lineTo(KP.layout.fullscreenMargin,O-6),ctx.lineTo(KP.layout.fullscreenMargin+10,O-6),ctx.moveTo(KP.layout.fullscreenMargin+20,O-6),ctx.lineTo(KP.layout.fullscreenMargin+30,O-6),ctx.lineTo(KP.layout.fullscreenMargin+30,O),ctx.moveTo(KP.layout.fullscreenMargin+30,O+9),ctx.lineTo(KP.layout.fullscreenMargin+30,O+15),ctx.lineTo(KP.layout.fullscreenMargin+20,O+15),ctx.moveTo(KP.layout.fullscreenMargin+10,O+15),ctx.lineTo(KP.layout.fullscreenMargin,O+15),ctx.lineTo(KP.layout.fullscreenMargin,O+9),ctx.stroke());let X="";if(video.duration>0){let Y=Math.floor((video.duration-0)/60),V=Math.floor((video.duration-0)%60),W=Math.floor(video.currentTime/60),U=Math.floor(video.currentTime%60);X+=W<10?"0"+W+":":W+":",X+=U<10?"0"+U:U,KP.layout.isNarrowCanvas||(X+=" / ",X+=Y<10?"0"+Y+":":Y+":",X+=V<10?"0"+V:V)}else X=KP.layout.isNarrowCanvas?"00:00":"00:00 / 00:00";ctx.fillStyle="white",ctx.font='15px "Arial"',ctx.textAlign="right",ctx.fillText(X,canvas.width-KP.config.SEEKBAR_MARGIN,canvas.height-20)}if(ctx.globalAlpha=1,KP.video.loading&&!KP.animation.play&&!KP.animation.pause&&!KP.animation.stepBack&&!KP.animation.stepForward){if(KP.video.bufCurrentTime!==video.currentTime)KP.video.loading=!1;else{ctx.fillStyle="rgba(0, 0, 0, 0.5)",ctx.fillRect(0,0,canvas.width,canvas.height),KP.animation.loadIndex++;let z,q=0;80===KP.animation.loadIndex&&(KP.animation.loadIndex=0);for(let Z=0;Z<2*Math.PI;Z+=Math.PI/4)z=14-(KP.animation.loadIndex/10+q++)%8*1.5,ctx.fillStyle="rgba(255, 255, 255, "+z/30+")",ctx.beginPath(),ctx.arc(canvas.width/2+60*Math.cos(Z),canvas.height/2-60*Math.sin(Z),z,0,2*Math.PI),ctx.fill()}}ctx.lineWidth=3,ctx.strokeStyle="black",ctx.strokeRect(0,0,canvas.width,canvas.height),requestAnimationFrame(draw)}function flipPlayPauseVideo(){KP.playback.playing?(video.pause(),KP.animation.play=!1,KP.animation.pause=!0,KP.playback.playing=!1,KP.ui.fading=!1,KP.animation.stopCount=100):(video.currentTime===video.duration-KP.config.DURATION_DIF&&(video.currentTime=0),video.play(),KP.animation.play=!0,KP.animation.pause=!1,KP.playback.playing=!0,KP.ui.onCanvas||(KP.ui.fading=!0,KP.animation.fadeAlpha=100)),KP.animation.stepBack=!1,KP.animation.stepForward=!1,KP.animation.alpha=KP.config.MAX_ALPHA}function stepBack(){video.currentTime=Math.max(0,video.currentTime-10),KP.animation.play=!1,KP.animation.pause=!1,KP.animation.stepBack=!0,KP.animation.stepForward=!1,KP.animation.alpha=KP.config.MAX_ALPHA}function stepForward(){video.currentTime<video.duration&&(video.currentTime=Math.min(video.duration-KP.config.DURATION_DIF,video.currentTime+10),video.currentTime===video.duration-KP.config.DURATION_DIF&&KP.playback.playing&&flipPlayPauseVideo()),KP.animation.play=!1,KP.animation.pause=!1,KP.animation.stepBack=!1,KP.animation.stepForward=!0,KP.animation.alpha=KP.config.MAX_ALPHA}function keyDown(e){switch(e.key){case" ":e.preventDefault(),flipPlayPauseVideo();break;case"ArrowRight":e.preventDefault(),stepForward();break;case"ArrowLeft":e.preventDefault(),stepBack();break;case"ArrowUp":e.preventDefault(),video.muted&&(video.muted=!1,video.volume=0),video.volume>.9?video.volume=1:(video.volume+=.1,video.volume>.99&&(video.volume=1));break;case"ArrowDown":e.preventDefault(),video.volume<.1?video.volume=0:(video.volume-=.1,video.volume<.01&&(video.volume=0));break;case"m":video.muted=!video.muted;break;case"f":case"F":e.preventDefault(),toggleFullscreen()}}function mouseClick(e){if(-1!==getMouseX(e)&&-1!==getMouseY(e)){if(KP.playback.finished){KP.ui.onReplay&&(KP.playback.finished=!1,video.currentTime=0,video.play(),KP.playback.playing=!0,KP.animation.play=!0,KP.animation.pause=!1,KP.animation.alpha=KP.config.MAX_ALPHA);return}if(KP.mouse.press=!1,KP.mouse.drag){KP.mouse.drag=!1;return}if(KP.ui.dragSeekBar){KP.ui.dragSeekBar=!1,KP.ui.pressSeekBar=!1,KP.playback.resume&&video.play(),KP.playback.playing&&(KP.video.bufCurrentTime=video.currentTime,KP.video.loading=!0);return}if(KP.ui.pressSeekBar){KP.ui.pressSeekBar=!1,KP.playback.resume&&video.play(),KP.playback.playing&&(KP.video.bufCurrentTime=video.currentTime,KP.video.loading=!0);return}if(KP.ui.dragVolumeControl||KP.ui.onVolumeControl){KP.ui.dragVolumeControl=!1,KP.ui.onVolumeControl=!1;return}if(KP.ui.dragOnController){KP.ui.dragOnController=!1,KP.ui.pressOnController=!1;return}if(KP.ui.pressPlayBackTrigger){for(let t=0;t<7;t++)if(KP.ui.onPlayBacks[t]){video.playbackRate=2-.2*t,KP.ui.onPlayBacks[t]=!1,KP.ui.pressPlayBackTrigger=!1,KP.ui.onPlayBackTrigger=!1;return}}else if(KP.ui.onPlayBackTrigger){KP.ui.pressPlayBackTrigger=!KP.ui.pressPlayBackTrigger;return}KP.ui.pressPlayBackTrigger=!1,KP.mouse.moveY>0&&canvas.height-KP.mouse.moveY>KP.config.SEEKBAR_HEIGHT+10?(flipPlayPauseVideo(),KP.ui.onPlayBackTrigger=!1):KP.ui.onPlayPause?(flipPlayPauseVideo(),KP.ui.onPlayBackTrigger=!1):KP.ui.onStepBack&&600>=!canvas.width?(stepBack(),KP.ui.onPlayBackTrigger=!1):KP.ui.onStepForward&&600>=!canvas.width?(stepForward(),KP.ui.onPlayBackTrigger=!1):KP.ui.onFaceTrace?(KP.ui.onPlayBackTrigger=!1,KP.ui.faceTrace?KP.ui.faceTrace=!1:KP.ui.faceTrace=!0):KP.ui.onVolume?(video.muted=!video.muted,KP.ui.onPlayBackTrigger=!1):KP.ui.onTheater?(flipTheaterMode(),KP.ui.onPlayBackTrigger=!1):KP.ui.onFullscreen&&(toggleFullscreen(),KP.ui.onPlayBackTrigger=!1)}}function mouseDown(e){if(!KP.playback.finished&&-1!==getMouseX(e)&&-1!==getMouseY(e)){if(!(KP.ui.pressPlayBackTrigger&&KP.mouse.moveX>KP.layout.theaterMargin&&KP.mouse.moveX<KP.layout.theaterMargin+40&&KP.mouse.moveY>canvas.height-213&&getMouseY(e)<canvas.height-10))if(8>Math.abs(canvas.height-KP.config.SEEKBAR_HEIGHT-KP.mouse.moveY)){KP.playback.resume=KP.playback.playing,video.pause(),KP.ui.pressSeekBar=!0,KP.mouse.dragX=getMouseX(e);let t=(KP.mouse.dragX-KP.config.SEEKBAR_MARGIN)/(canvas.width-2*KP.config.SEEKBAR_MARGIN);t=Math.max(0,Math.min(1,t)),video.currentTime=(video.duration-KP.config.DURATION_DIF)*t}else if(KP.mouse.moveX>KP.layout.VOLUME_MARGIN+40&&KP.mouse.moveX<KP.layout.VOLUME_MARGIN+115&&KP.mouse.moveY>canvas.height-35&&KP.mouse.moveY<canvas.height-15){video.muted=!1,KP.ui.KP.ui.onVolumeControl=!0,KP.mouse.dragX=getMouseX(e);let a=(KP.mouse.dragX-KP.layout.VOLUME_MARGIN-42)/70;a=Math.max(0,Math.min(1,a)),video.volume=a}else canvas.height-KP.mouse.moveY>KP.config.SEEKBAR_HEIGHT?(KP.coords.leftBuf=KP.coords.left,KP.coords.topBuf=KP.coords.top,KP.mouse.press=!0):KP.ui.pressOnController=!0}}function mouseUp(e){KP.ui.pressOnController=!1,KP.mouse.press=!1}function mouseOut(){returnScroll(),KP.ui.onCanvas=!1,KP.mouse.press=!1,KP.ui.pressSeekBar=!1,KP.ui.dragSeekBar=!1,KP.ui.onVolumeControl=!1,KP.ui.dragVolumeControl=!1,offAllFlags(),document.body.style.cursor="auto",KP.playback.playing&&(KP.ui.fading=!0,KP.animation.fadeAlpha=50),KP.playback.finished&&(KP.ui.onReplay=!1)}function mouseOver(){noScroll(),KP.ui.onCanvas=!0,KP.animation.fadeAlpha=50,KP.ui.fading=!1}function mouseMove(e){if(KP.mouse.xAnytime=getMouseX(e),KP.mouse.yAnytime=getMouseY(e),-1===KP.mouse.xAnytime||-1===KP.mouse.yAnytime){document.body.style.cursor="auto",offAllFlags();return}if(KP.playback.finished){KP.mouse.moveX=getMouseX(e),KP.mouse.moveY=getMouseY(e);let t=(canvas.width-200)/2;KP.mouse.moveX>t&&KP.mouse.moveX<t+200&&KP.mouse.moveY>KP.layout.replayPosY&&KP.mouse.moveY<KP.layout.replayPosY+KP.layout.replayHeight?(KP.ui.onReplay=!0,document.body.style.cursor="pointer"):(KP.ui.onReplay=!1,document.body.style.cursor="auto");return}if(KP.ui.onCanvas||(KP.ui.onCanvas=!0),KP.ui.fading=!1,KP.animation.stopCount=100,getMouseY(e)>canvas.height-KP.config.SEEKBAR_HEIGHT-10&&getMouseY(e)<canvas.height?KP.ui.onMediaControl=!0:KP.ui.onMediaControl=!1,KP.ui.dragOnController=KP.ui.pressOnController&&(getMouseX(e)!==KP.mouse.moveX||getMouseY(e)!==KP.mouse.moveY),KP.ui.pressSeekBar){KP.ui.dragSeekBar=!0,KP.mouse.dragX=getMouseX(e);let a=(KP.mouse.dragX-KP.config.SEEKBAR_MARGIN)/(canvas.width-2*KP.config.SEEKBAR_MARGIN);a=Math.max(0,Math.min(1,a)),video.currentTime=(video.duration-KP.config.DURATION_DIF)*a}else if(KP.ui.onVolumeControl){KP.ui.dragVolumeControl=!0,KP.mouse.dragX=getMouseX(e);let i=(KP.mouse.dragX-KP.layout.VOLUME_MARGIN-42)/70;i=Math.max(0,Math.min(1,i)),video.volume=i;return}if(KP.mouse.press){if(KP.mouse.dragX=getMouseX(e),KP.mouse.dragY=getMouseY(e),KP.mouse.dragX===KP.mouse.moveX&&KP.mouse.dragY===KP.mouse.moveY||(KP.mouse.drag=!0,1===KP.video.scale))return;KP.coords.left=KP.coords.leftBuf+(KP.mouse.moveX-KP.mouse.dragX)/KP.video.scale,KP.coords.top=KP.coords.topBuf+(KP.mouse.moveY-KP.mouse.dragY)/KP.video.scale,KP.coords.left=Math.max(0,Math.min(canvas.width-KP.coords.width,KP.coords.left)),KP.coords.top=Math.max(0,Math.min(canvas.height-KP.coords.height,KP.coords.top))}else if(!KP.ui.dragOnController){KP.mouse.drag=!1,KP.mouse.moveX=getMouseX(e),KP.mouse.moveY=getMouseY(e);let o=canvas.height-213,n=canvas.height-10;KP.ui.pressPlayBackTrigger&&KP.mouse.moveX>KP.layout.theaterMargin&&KP.mouse.moveX<KP.layout.theaterMargin+40&&KP.mouse.moveY>o&&getMouseY(e)<n?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onPlayBackTrigger=!0,KP.ui.onPlayBacks[Math.floor((KP.mouse.moveY-o)/25)]=!0):8>Math.abs(canvas.height-KP.config.SEEKBAR_HEIGHT-KP.mouse.moveY)?(document.body.style.cursor="pointer",KP.ui.onSeekBar||(KP.animation.seekBallRad=0),offAllFlags(),KP.ui.onSeekBar=!0):KP.mouse.moveX>KP.config.SEEKBAR_MARGIN&&KP.mouse.moveX<3*KP.config.SEEKBAR_MARGIN+5&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onPlayPause=!0):!KP.layout.isNarrowCanvas&&KP.mouse.moveX>KP.config.STEP_BACK_MARGIN-15&&KP.mouse.moveX<KP.config.STEP_BACK_MARGIN+13&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onStepBack=!0):!KP.layout.isNarrowCanvas&&KP.mouse.moveX>KP.config.STEP_FORWARD_MARGIN-15&&KP.mouse.moveX<KP.config.STEP_FORWARD_MARGIN+13&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onStepForward=!0):KP.mouse.moveX>KP.layout.VOLUME_MARGIN-7&&KP.mouse.moveX<KP.layout.VOLUME_MARGIN+32&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onVolume=!0):KP.mouse.moveX>KP.layout.VOLUME_MARGIN+40&&KP.mouse.moveX<KP.layout.VOLUME_MARGIN+115&&KP.mouse.moveY>canvas.height-35&&KP.mouse.moveY<canvas.height-15?document.body.style.cursor="pointer":KP.mouse.moveX>KP.config.FACE_TRACE_MARGIN-15&&KP.mouse.moveX<KP.config.FACE_TRACE_MARGIN+13&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onFaceTrace=!0):KP.mouse.moveX>KP.layout.theaterMargin&&KP.mouse.moveX<KP.layout.theaterMargin+40&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height-10?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onPlayBackTrigger=!0):KP.mouse.moveX>KP.layout.fullscreenMargin-6&&KP.mouse.moveX<KP.layout.fullscreenMargin+36&&KP.mouse.moveY>canvas.height-KP.config.SEEKBAR_HEIGHT+10&&getMouseY(e)<canvas.height?(document.body.style.cursor="pointer",offAllFlags(),KP.ui.onFullscreen=!0):(document.body.style.cursor="auto",offAllFlags())}}function getDrawingArea(){let e=canvas.getBoundingClientRect(),t=canvas.width/canvas.height,a=e.width/e.height,i,o,n,l;return a>t?(i=(o=e.height)*t,n=(e.width-i)/2,l=0):(o=(i=e.width)/t,n=0,l=(e.height-o)/2),{rect:e,drawWidth:i,drawHeight:o,offsetX:n,offsetY:l}}function isClickInMargin(e){let t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!t)return!1;let{rect:a,drawWidth:i,drawHeight:o,offsetX:n,offsetY:l}=getDrawingArea(),c=e.clientX-a.left,r=e.clientY-a.top;return c<n||c>n+i||r<l||r>l+o}function getMouseX(e){if(isClickInMargin(e))return -1;let t=e.target.getBoundingClientRect(),a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!a)return e.clientX-t.left;{let{drawWidth:i,offsetX:o}=getDrawingArea(),n=canvas.width/i;return(e.clientX-t.left-o)*n}}function getMouseY(e){if(isClickInMargin(e))return -1;let t=e.target.getBoundingClientRect(),a=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(!a)return e.clientY-t.top;{let{drawHeight:i,offsetY:o}=getDrawingArea(),n=canvas.height/i;return(e.clientY-t.top-o)*n}}function offAllFlags(){KP.ui.onSeekBar=!1,KP.ui.onPlayPause=!1,KP.ui.onStepBack=!1,KP.ui.onStepForward=!1,KP.ui.onFaceTrace=!1,KP.ui.onVolume=!1,KP.ui.onVolumeControl=!1,KP.ui.onTheater=!1,KP.ui.onPlayBackTrigger=!1,KP.ui.onFullscreen=!1,KP.ui.onPlayBacks.fill(!1)}function canvasZoom(e){if(KP.playback.finished)return;KP.mouse.x=getMouseX(e),KP.mouse.y=getMouseY(e),-1==KP.mouse.prevX&&(KP.mouse.prevX=KP.mouse.x);let t=!0;if(e.timeStamp-KP.system.timeStamp<30)return;KP.system.timeStamp=e.timeStamp;let a=e.wheelDelta>0;if(a)KP.video.scaleIndex++,KP.video.scale=1+.2*KP.video.scaleIndex,KP.video.scale>KP.config.MAX_SCALE&&(KP.video.scale=KP.config.MAX_SCALE,KP.video.scaleIndex--,t=!1);else if(KP.video.scaleIndex--,KP.video.scale=1+.2*KP.video.scaleIndex,KP.video.scale<1){KP.video.scale=1,KP.video.scaleIndex=0,KP.coords.left=0,KP.coords.width=canvas.width,KP.coords.top=0,KP.coords.height=canvas.height;return}if(t){let i=.2/(KP.video.scale*(KP.video.scale+(a?-.2:.2)));KP.coords.left+=a?KP.mouse.x*i:-(KP.mouse.x*i),KP.coords.top+=a?KP.mouse.y*i:-(KP.mouse.y*i),KP.coords.width=canvas.width/KP.video.scale,KP.coords.height=canvas.height/KP.video.scale,KP.coords.left=Math.max(0,Math.min(canvas.width-KP.coords.width,KP.coords.left)),KP.coords.top=Math.max(0,Math.min(canvas.height-KP.coords.height,KP.coords.top))}t&&(KP.mouse.imageDifX=KP.coords.left+KP.coords.width*KP.mouse.x/canvas.width,KP.mouse.imageDifY=KP.coords.top+KP.coords.height*KP.mouse.y/canvas.height,KP.mouse.imageDifX<0&&(KP.mouse.imageDifX=0),KP.mouse.imageDifX>canvas.width&&(KP.mouse.imageDifX=canvas.width),KP.mouse.imageDifY<0&&(KP.mouse.imageDifY=0),KP.mouse.imageDifY>canvas.height&&(KP.mouse.imageDifY=canvas.height)),KP.mouse.prevX=KP.mouse.x}function toggleFullscreen(){if(KP.ui.isFullscreenMode){cancelFullScreen(),KP.ui.isFullscreenMode=!1;let e=document.getElementById("main");e&&(e.style.background="white"),canvas&&(canvas.style.maxWidth=KP.layout.originalMaxWidth)}else{KP.layout.scrollPosBuf=window.pageYOffset,KP.layout.canvasWidthBuf=canvas.clientWidth,goFullScreen(canvas),KP.ui.isFullscreenMode=!0;let t=0;t=window.innerWidth*KP.video.HEIGHT/KP.video.WIDTH<=window.innerHeight?window.innerWidth:window.innerHeight*KP.video.WIDTH/KP.video.HEIGHT-10,canvas&&(canvas.style.maxWidth=t+"px")}KP.ui.onFullscreen=!1,init()}function flipTheaterMode(){if(KP.ui.theaterMode){cancelFullScreen(canvas),KP.ui.theaterTmp=!0,KP.ui.theaterMode=!1;let e=document.getElementById("main");e&&(e.style.background="white"),canvas&&(canvas.style.maxWidth=KP.layout.originalMaxWidth)}else{KP.layout.scrollPosBuf=window.pageYOffset,KP.layout.canvasWidthBuf=canvas.clientWidth,goFullScreen(canvas);let t=0;t=window.innerWidth*KP.video.HEIGHT/KP.video.WIDTH<=window.innerHeight?window.innerWidth:window.innerHeight*KP.video.WIDTH/KP.video.HEIGHT-10,canvas&&(canvas.style.maxWidth=t+"px"),KP.ui.theaterMode=!0}KP.ui.onTheater=!1}function noScroll(){document.addEventListener("mousewheel",scrollControl,{passive:!1})}function returnScroll(){document.removeEventListener("mousewheel",scrollControl,{passive:!1})}function scrollControl(e){e.preventDefault()}function eventFullScreen(e){document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1)}function enabledFullScreen(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.documentElement.webkitRequestFullScreen||document.msFullscreenEnabled}function goFullScreen(e){let t=window.document,a=null===e?t.documentElement:e;(a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||a.msRequestFullscreen).call(a)}function cancelFullScreen(){let e=window.document,t=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;t.call(e)}function getFullScreenObject(){let e=window.document,t=e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement;return t}function isFullScreen(){return void 0!==document.FullscreenElement&&null!==document.FullscreenElement||void 0!==document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement}if(document.addEventListener("keydown",keyDown),canvas.addEventListener("click",mouseClick),canvas.addEventListener("mousemove",mouseMove),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mouseout",mouseOut),canvas.addEventListener("mouseover",mouseOver),canvas.addEventListener("mousewheel",canvasZoom),window.addEventListener("resize",function(){let e=0;e=window.innerWidth*KP.video.HEIGHT/KP.video.WIDTH<=window.innerHeight?window.innerWidth:window.innerHeight*KP.video.WIDTH/KP.video.HEIGHT-10,KP.ui.theaterMode||(e=Math.min(e,parseInt(KP.layout.originalMaxWidth)||1200)),canvas&&(canvas.style.maxWidth=e+"px"),init()},!1),document.addEventListener("webkitfullscreenchange",handleFSevent,!1),document.addEventListener("mozfullscreenchange",handleFSevent,!1),document.addEventListener("MSFullscreenChange",handleFSevent,!1),document.addEventListener("fullscreenchange",handleFSevent,!1),video.addEventListener("waiting",function(e){KP.video.bufCurrentTime=video.currentTime,KP.video.loading=!0}),video.addEventListener("canplay",function(e){KP.video.loading=!1}),video.addEventListener("loadedmetadata",function(e){KP.video.WIDTH=video.videoWidth||1920,KP.video.HEIGHT=video.videoHeight||1080,KP.video.metadataLoaded?init():(KP.video.metadataLoaded=!0,init(),draw())}),video.addEventListener("loadeddata",function(e){KP.playback.playing||draw()}),video&&(video.width=0,video.height=0),canvas){if(canvas.style.maxWidth&&""!==canvas.style.maxWidth)KP.layout.originalMaxWidth=canvas.style.maxWidth;else{let e=window.getComputedStyle(canvas);e.maxWidth&&"none"!==e.maxWidth&&(KP.layout.originalMaxWidth=e.maxWidth)}canvas.style.display="block",canvas.style.margin="0 auto"}"undefined"==typeof captions&&(window.captions=[]),"undefined"==typeof debug&&(window.debug=!1),KP.video.WIDTH=video.videoWidth||1920,KP.video.HEIGHT=video.videoHeight||1080,init(),draw();